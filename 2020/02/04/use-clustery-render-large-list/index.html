

<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <title>DarkZone&#39;Home</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    
    <meta name="description" content="å°å‰ç«¯, åšå®¢, JS, CSS, WEB">
    <meta property="og:description" content="å°å‰ç«¯, åšå®¢, JS, CSS, WEB">
    
    <meta name="author" content="darkzone">

    
    <meta property="og:title" content="å‰ç«¯é•¿åˆ—è¡¨æ¸²æŸ“ä¼˜åŒ–">
    <meta property="twitter:title" content="å‰ç«¯é•¿åˆ—è¡¨æ¸²æŸ“ä¼˜åŒ–">
    

    <link rel="stylesheet" href="/posts/css/style.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.9.0/styles/tomorrow.min.css">
</head>
</html>
<body>
    <div id="container"  class="full"  >
        
<div class="cover  full " style="background-image:url(/posts/css/img/thumb.jpeg);">
    <div class="cover-inner">
        <a class="you" href="/">
            <img class="radius" src="/posts/css/img/avatar.jpeg" alt="avatar">
            <h1>DarkZone</h1>
            <h3 style="display: none;">Web Developer</h3>
        </a>
        <hr class="divider long">
        <div class="desc">
            <p>å°å‰ç«¯ / æ­»å®…ç”·</p>
            <p>å¶å°”æŠ½é£ / æ—¶å¸¸ä¸æ­£ç»</p>
        </div>
        <hr class="divider short">
        <div class="links">
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/posts">Posts</a></li>
                <li><a href="/posts/about">About</a></li>
            </ul>
        </div>
        <div class="links socials">
            <ul>
                <li>
                    <a href="https://github.com/zjzhome" target="_blank">
                        <i class="icon ion-social-github"></i>
                    </a>
                </li>
                <li>
                    <a href="mailto:zjzhome@126.com?subject=Hello,%20I%20saw%20your%20web!">
                        <i class="icon ion-email"></i>
                    </a>
                </li>
                <li>
                    <a href="atom.xml" target="_blank">
                        <i class="icon ion-social-rss"></i>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>
        
<div class="wrapper post-page">
    <div class="post-header" style="background-image:url(/posts/assets/img/performance.jpg)">
        <a class="anchor full" href="javascript:void(0);" id="anchor">
            <img class="radius" src="/posts/css/img/avatar_1.jpeg" alt="avatar">
        </a>
        <p class="post-time">posted @ 2020/2/4, 4:57:33 ä¸‹åˆ</p>
        <h1 class="post-title">
            å‰ç«¯é•¿åˆ—è¡¨æ¸²æŸ“ä¼˜åŒ–
            
        </h1>
        
        <div class="post-tag">
            <a class="tag-link" href="/posts/tags/JavaScript/">JavaScript</a>, <a class="tag-link" href="/posts/tags/performance/">performance</a>
        </div>
        
    </div>
    <div class="post-content">
        <p>å¯¹äºé•¿åˆ—è¡¨ï¼Œä¸€èˆ¬çš„åº”ç”¨å¯ä»¥é€šè¿‡åˆ†é¡µè§£å†³ã€‚ç„¶è€Œç°åœ¨å¾ˆå¤šçš„åº”ç”¨åˆ—è¡¨éƒ¨åˆ†å¯èƒ½æ˜¯æ»šåŠ¨åŠ è½½çš„ï¼Œéšç€æ»šåŠ¨ï¼Œåˆ—è¡¨é¡¹è¶Šæ¥è¶Šå¤šï¼Œå½±å“æ€§èƒ½å’Œä½“éªŒï¼Œå°¤å…¶æ˜¯ç§»åŠ¨è®¾å¤‡ä¸Šï¼›å¦ä¸€ç§æ˜¯IMåº”ç”¨ï¼Œåƒä¼šè¯åˆ—è¡¨ã€å¥½å‹åˆ—è¡¨ã€ç¾¤æˆå‘˜åˆ—è¡¨é€šå¸¸ä¼šä¸€æ¬¡æ€§åŠ è½½ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå¯¹äºé•¿åˆ—è¡¨çš„ä¼˜åŒ–å°±æ˜¾å¾—å¾ˆæœ‰å¿…è¦ã€‚</p>
<p><a href="http://clusterize.js.org/" target="_blank" rel="noopener">Clusterize.js</a>å°±æ˜¯è¿™æ ·ä¸€ä¸ªåº“ï¼ŒçŸ­å°ç²¾æ‚ã€‚å®ƒä¼šå°†åˆ—è¡¨åˆ’åˆ†æˆä¸€ä¸ªä¸ªçš„clusterï¼Œéšç€æ»šåŠ¨åªæ˜¾ç¤ºå½“å‰å¯è§çš„clusterï¼Œå¹¶åœ¨åˆ—è¡¨çš„é¡¶éƒ¨å’Œåº•éƒ¨å¡«å……é¢å¤–çš„é«˜åº¦ï¼Œå±•ç¤ºåˆ—è¡¨çš„çœŸå®é«˜åº¦ã€‚</p>
<blockquote>
<p>The main idea is not to pollute DOM with all used tags. Instead of that - it splits the list to clusters, then shows elements for current scroll position and adds extra rows to top and bottom of the list to emulate full height of table so that browser shows scrollbar as for full list.</p>
</blockquote>
<p>ä¸è¿‡Clusterize.jsæ˜¯åŸºäºDOMçš„ï¼Œéšç€MVVMæ¡†æ¶çš„æµè¡Œï¼Œå¤§å®¶æ›´å¤šçš„æ˜¯åœ¨æ“ä½œæ•°æ®ï¼Œæ‰€ä»¥æˆ‘åŸºäºClusterize.jsåšäº†Clustery.jsã€‚</p>
<h2 id="å¦‚ä½•ä½¿ç”¨-clustery-js">å¦‚ä½•ä½¿ç”¨ Clustery.js</h2>
<p>é¦–å…ˆäº†è§£ä¸€ä¸‹<a href="http://clusterize.js.org/" target="_blank" rel="noopener">Clusterize.js</a>ã€‚</p>
<p>Clusterize.jsæœ‰è¶…å¤šçš„é…ç½®é¡¹ã€å…¬å…±æ–¹æ³•å’Œå›è°ƒå‡½æ•°ï¼Œåœ¨æ“ä½œ DOM çš„æ—¶å€™æ¯”è¾ƒæœ‰ç”¨ã€‚Clustery.js åšäº†å¤§é‡çš„ç®€åŒ–ï¼Œä¸å¿…å†å¼•å…¥ Clusterize.js è‡ªå¸¦çš„ cssï¼Œå¢åŠ äº† <code>item_height</code> çš„é…ç½®ï¼Œæ˜¾å¼çš„å£°æ˜æ¯ä¸€é¡¹çš„é«˜åº¦ï¼›<code>rows</code> ä¸å†æ˜¯ DOM å…ƒç´ çš„æ•°ç»„ï¼Œè€Œæ˜¯ç”¨äºæ¸²æŸ“çš„æ•°æ®ã€‚ä¸‹é¢æ˜¯æ‰€æœ‰çš„é…ç½®é¡¹ã€å›è°ƒå’Œå…¬å…±æ–¹æ³•ï¼š</p>
<pre><code class="language-js">this.clustery = new Clustery({
    scrollElem: scrollElem,
    contentElem: contentElem,
    rows: rows,
    item_height: itemHeight,
    rows_in_block: 20,
    blocks_in_cluster: 4,
    callbacks: {
        shouldUpdate: function(data) {
            _this.setRenderData(data)
        }
    }
});

// if you want to destroy
this.clustery.destroy();

// if you modify itemHeight manually
this.clustery.refresh(item_height);

// if you update data
this.clustery.update(newRows);
</code></pre>
<p><code>callbacks</code>æš‚æ—¶åªæœ‰ä¸€ä¸ªå›è°ƒï¼Œå½“éœ€è¦æ¸²æŸ“çš„æ•°æ®æ”¹å˜æ—¶è§¦å‘ <code>shouldUpdate</code> æ–¹æ³•ï¼Œå‚æ•° <code>_data</code> å¯èƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªæ•°å­—(ä»…ä»…æ˜¯ <code>bottom_offset</code> æ”¹å˜)ï¼š</p>
<pre><code class="language-js">{
    start: 0,   // æ¸²æŸ“åˆ—è¡¨ä»startåˆ°end, æ­¤æ—¶éœ€è¦æ¸²æŸ“arr.slice(start, end)   
    end: 80,
    top_offset: 1245,   // åˆ—è¡¨é¡¶éƒ¨å¡«å……é«˜åº¦
    bottom_offset: 3349 // åˆ—è¡¨åº•éƒ¨å¡«å……é«˜åº¦
}
</code></pre>
<p>å¯ä»¥å» Github ä¸­æŸ¥çœ‹ <a href="https://github.com/zjzhome/Clustery.js" target="_blank" rel="noopener">DEMO</a></p>
<p>å¦‚æœä½ å¯¹å®ç°åŸç†æ„Ÿå…´è¶£ï¼Œè¯·ç»§ç»­å¾€ä¸‹çœ‹ ğŸ˜‰</p>
<h2 id="å®ç°åŸç†">å®ç°åŸç†</h2>
<p>ä¸ºäº†å®ç°éšæ»šåŠ¨åªåŠ è½½å¯è§åŒºåŸŸï¼ŒClusterize.js å¼•å…¥äº†å‡ ä¸ªæ¦‚å¿µï¼š</p>
<pre><code class="language-js">{
    rows_in_block: 0,     // æ¯ä¸€ä¸ªblockåŒ…å«çš„rows
    block_height: 0,      // æ¯ä¸€ä¸ªblockçš„é«˜åº¦ item_height * rows_in_block
    blocks_in_cluster: 4, // æ¯ä¸ªclusteråŒ…å«çš„blocksçš„ä¸ªæ•°
    rows_in_cluster: 0,   // æ¯ä¸€ä¸ªclusteråŒ…å«çš„rows blocks_in_cluster * rows_in_block
    cluster_height: 0,    // æ¯ä¸€ä¸ªclusterçš„é«˜åº¦ block_height * blocks_in_cluster
}
</code></pre>
<p>æ•´ä¸ªåˆ—è¡¨è¢«åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªçš„ <code>cluster</code>ï¼Œæ¯ä¸ª <code>cluster</code> åŒ…å«å¤šä¸ª <code>block</code>ï¼Œæ¯ä¸ª <code>block</code>åŒ…å«å¤šä¸ª <code>rows</code>ï¼Œä¹Ÿå°±æ˜¯æ¸²æŸ“çš„æœ€å°å•ä½ - æ¯è¡Œæ•°æ®ã€‚</p>
<p>é¦–å…ˆè¦ç¡®å®šä¸Šè¿°å‡ ä¸ªé…ç½®é¡¹çš„å€¼ã€‚æ¯ä¸€é¡¹çš„é«˜åº¦ <code>item_height</code> æ˜¯ç”±ç”¨æˆ·ä¼ å…¥çš„ï¼Œç„¶åéœ€è¦ç¡®å®šçš„æ˜¯ <code>row_in_block</code>ï¼Œå› ä¸ºå…¶ä»–å‡ ä¸ªå€¼å¾—è®¡ç®—éƒ½æ˜¯ä¾èµ–äºå®ƒçš„ï¼š</p>
<pre><code class="language-js">// æˆ‘ä»¬å°†æ•´ä¸ªå¯è§çš„åŒºåŸŸä½œä¸ºä¸€ä¸ª block
// é™¤ä»¥ item_height å°±å¾—åˆ°æ¯ä¸ª block å†…åŒ…å«çš„ rows

if(!opts.rows_in_block) {
  opts.rows_in_block = Math.ceil(this.scroll_elem.offsetHeight / opts.item_height);
}
</code></pre>
<p>å…¶ä»–é…ç½®é¡¹ä¹Ÿèƒ½è½»æ¾å¾—åˆ°äº†ï¼š</p>
<pre><code class="language-js">opts.block_height = opts.item_height * opts.rows_in_block;
opts.rows_in_cluster = opts.blocks_in_cluster * opts.rows_in_block;
opts.cluster_height = opts.blocks_in_cluster * opts.block_height;
</code></pre>
<p>ç„¶åå°±å¼€å§‹å¤„ç†ç”¨æˆ·æ»šåŠ¨çš„äº‹ä»¶äº†ï¼Œéšç€ç”¨æˆ·æ»šåŠ¨ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šéœ€è¦æ¸²æŸ“å“ªä¸ª <code>cluster</code>:</p>
<pre><code class="language-js">// get current cluster number
// ä¸€ä¸ª cluster åŒ…å«å¤šä¸ª block, æ•´ç†å‡æ‰ä¸€ä¸ª block çš„é«˜åº¦å¯ä»¥çœ‹ä½œæ˜¯ç¼“å†²
// åœ¨ç”¨æˆ·æ²¡æœ‰æ»šåŠ¨åˆ°è¿™ä¸ª cluster çš„åº•éƒ¨çš„æ—¶å€™å°±å·²ç»åŠ è½½ä¸‹ä¸ª cluster, é˜²æ­¢å‡ºç°çŸ­æš‚çš„ç©ºç™½.
getClusterNum: function () {
  this.options.scroll_top = this.scroll_elem.scrollTop;
  return Math.floor(this.options.scroll_top / (this.options.cluster_height - this.options.block_height)) || 0;
}
</code></pre>
<p>ç„¶åæˆ‘ä»¬éœ€è¦ç”Ÿæˆæ–°çš„ cluster è¿›è¡Œæ¸²æŸ“ï¼š</p>
<pre><code class="language-js">// å…¶å®æ˜¯ getClusterNum çš„ä¸€æ¬¡åå‘è¿ç®—ï¼Œè®¡ç®—å‡ºæ•°æ®ä»ç¬¬å‡ é¡¹å¼€å§‹æ¸²æŸ“
var items_start = Math.max((opts.rows_in_cluster - opts.rows_in_block) * cluster_num, 0),
  items_end = items_start + opts.rows_in_cluster,
  top_offset = Math.max(items_start * opts.item_height, 0),
  bottom_offset = Math.max((rows_len - items_end) * opts.item_height, 0);
</code></pre>
<p>å…¶å®æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ¯ä¸ª cluster å¹¶ä¸æ˜¯ç‹¬ç«‹çš„ï¼Œè€Œæ˜¯é‡å çš„ï¼Œæ‰€ä»¥åœ¨å¿«é€Ÿæ»šåŠ¨çš„æ—¶å€™ï¼Œä¸ä¼šæœ‰ç©ºç™½çš„æƒ…å†µå‡ºç°ã€‚</p>
<p>æœ€ååº“é¢å¤–åšäº†å…¶ä»–äº‹æƒ…ï¼ŒæŠŠä¹‹å‰çš„æ•°æ®ç¼“å­˜èµ·æ¥ï¼Œæ»šåŠ¨çš„åçš„è®¡ç®—ç»“æœå’Œç¼“å­˜å†…çš„æ¯”è¾ƒï¼Œå¦‚æœæœ‰å˜åŒ–ï¼Œå°±è°ƒç”¨ç”¨æˆ·ä¼ å…¥çš„å›è°ƒå‡½æ•°é€šçŸ¥ç”¨æˆ·æ¸²æŸ“æ•°æ®ã€‚</p>

    </div>

    
    <div class="update-tip">**æœ¬æ–‡äº 2020/2/4, 4:57:33 ä¸‹åˆ é‡æ–°ç¼–è¾‘**</div>
    

    <div class="comment">
        <!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  -->
        <div id="lv-container" data-id="city" data-uid="MTAyMC8zMDYwNS83MTYw">
            <script type="text/javascript">
           (function(d, s) {
               var j, e = d.getElementsByTagName(s)[0];

               if (typeof LivereTower === 'function') { return; }

               j = d.createElement(s);
               j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
               j.async = true;

               e.parentNode.insertBefore(j, e);
           })(document, 'script');
            </script>
        <noscript> ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>
        </div>
        <!-- Cityç‰ˆå®‰è£…ä»£ç å·²å®Œæˆ -->        
    </div>

</div>
<script src="/posts/js/post.js"></script>
    </div>

    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script type="text/javascript">
        hljs.initHighlightingOnLoad();
    </script>
</body>
</html>