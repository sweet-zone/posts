

<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <title>DarkZone&#39;Home</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    
    <meta name="description" content="å°å‰ç«¯, åšå®¢, JS, CSS, WEB">
    <meta property="og:description" content="å°å‰ç«¯, åšå®¢, JS, CSS, WEB">
    
    <meta name="author" content="darkzone">

    
    <meta property="og:title" content="vue ssr å®è·µ">
    <meta property="twitter:title" content="vue ssr å®è·µ">
    

    <link rel="stylesheet" href="/posts/css/style.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.9.0/styles/tomorrow.min.css">
</head>
</html>
<body>
    <div id="container"  class="full"  >
        
<div class="cover  full " style="background-image:url(/posts/css/img/thumb.jpeg);">
    <div class="cover-inner">
        <a class="you" href="/">
            <img class="radius" src="/posts/css/img/avatar.jpeg" alt="avatar">
            <h1>DarkZone</h1>
            <h3 style="display: none;">Web Developer</h3>
        </a>
        <hr class="divider long">
        <div class="desc">
            <p>å°å‰ç«¯ / æ­»å®…ç”·</p>
            <p>å¶å°”æŠ½é£ / æ—¶å¸¸ä¸æ­£ç»</p>
        </div>
        <hr class="divider short">
        <div class="links">
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/posts">Posts</a></li>
                <li><a href="/posts/about">About</a></li>
            </ul>
        </div>
        <div class="links socials">
            <ul>
                <li>
                    <a href="https://github.com/zjzhome" target="_blank">
                        <i class="icon ion-social-github"></i>
                    </a>
                </li>
                <li>
                    <a href="mailto:zjzhome@126.com?subject=Hello,%20I%20saw%20your%20web!">
                        <i class="icon ion-email"></i>
                    </a>
                </li>
                <li>
                    <a href="atom.xml" target="_blank">
                        <i class="icon ion-social-rss"></i>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>
        
<div class="wrapper post-page">
    <div class="post-header" style="background-image:url(/posts/assets/img/vue-ssr.jpg)">
        <a class="anchor full" href="javascript:void(0);" id="anchor">
            <img class="radius" src="/posts/css/img/avatar_1.jpeg" alt="avatar">
        </a>
        <p class="post-time">posted @ 2020/2/4, 4:57:33 ä¸‹åˆ</p>
        <h1 class="post-title">
            vue ssr å®è·µ
            
        </h1>
        
        <div class="post-tag">
            <a class="tag-link" href="/posts/tags/ssr/">ssr</a>
        </div>
        
    </div>
    <div class="post-content">
        <h2 id="é¡µé¢æ¸²æŸ“å†å²">é¡µé¢æ¸²æŸ“å†å²</h2>
<p>é¡µé¢æ¸²æŸ“çš„å†å²å°±æ˜¯å‰ç«¯åŠªåŠ›æ‘†è„±åç«¯çš„å†å²ã€‚</p>
<p>æ—©äº›æ—¶å€™ï¼Œæ²¡æœ‰å‰åç«¯ä¹‹åˆ†ï¼Œåç«¯è‡ªå·±å¥—æ¨¡æ¿å†™é¡µé¢ï¼Œç¨å¾®ç»éªŒå¤šäº›å¹´å²çš„åç«¯ç¨‹åºå‘˜éƒ½æ˜¯æœ‰è‡ªå·±å†™é¡µé¢çš„ç»å†çš„ç»å†çš„ã€‚ï¼ˆé‚£äº›å¹´ï¼Œå›¾ä¹¦é¦†è¿˜æµè¡Œç½‘é¡µè®¾è®¡ä¸‰å‰‘å®¢ï¼Œasp ç”Ÿæ‹–ç¡¬æ‹½â€¦ï¼‰ã€‚å†å¾€åäº›ï¼Œæœ‰äº†åƒ FreeMarker è¿™æ ·çš„é«˜çº§æ¨¡æ¿ï¼Œä½†å‰ç«¯ä¾ç„¶æ²¡æœ‰æ‘†è„±å¼ºä¾èµ–åç«¯çš„å±€é¢ã€‚å†åæ¥ï¼Œå®¢æˆ·ç«¯æ¸²æŸ“æ…¢æ…¢å…´èµ·ï¼ŒAngularJS æ¨ªç©ºå‡ºä¸–ï¼ŒReactã€Vueç´§éšå…¶åï¼ŒSPA åº”ç”¨é€æ¸æµè¡Œäº†èµ·æ¥ï¼Œä¸€ç›´åˆ°ç°åœ¨éƒ½æ˜¯ä¸»æµï¼Œå°¤å…¶æ˜¯å„ç§ä¸­åå°ç³»ç»Ÿã€‚</p>
<p>SPAç«äº†ä¹‹åï¼Œåˆæœ‰ SEOã€é¦–å±æ—¶é—´ã€æ¥å£ä¸è‡ªç”±ç­‰ç­‰çš„çƒ¦æ¼ï¼Œæ‰€ä»¥ Node å‡ºç°ä¹‹åï¼Œå¤§å®¶ä»¿ä½›çœ‹è§äº†æ•‘å‘½ç¨»è‰ã€‚é™¤äº†å·¥å…·é“¾ï¼Œå‰ç«¯ä¹Ÿåœ¨æ¢ç´¢ Node åœ¨ä¸šåŠ¡ä¸­çš„åº”ç”¨ï¼Œå¹¶ä¸”æœ‰å¤§é‡çš„ä¸šåŠ¡å·²ç»è½åœ°ã€‚å¤§å¤šæ—¶å€™ Node éƒ½æ˜¯ä½œä¸ºä»‹äº Java å’Œ å‰ç«¯ä¹‹é—´çš„åª’ä»‹å­˜åœ¨çš„ï¼Œé‚£è‡ªç„¶ï¼Œæœ€æ—©æ—¶å€™çš„ Java æ¨¡æ¿ï¼ŒNode ä¹Ÿå¯ä»¥æ¥åšï¼Œè€Œä¸”å¯ä»¥åšçš„æ›´åŠ ä»å®¹ï¼Œæ¯•ç«Ÿå‰ç«¯è‡ªå·±æ§åˆ¶ã€‚</p>
<p>å†™ä¹…äº†ä¼šå‘ç°ï¼Œè¿˜æ˜¯å¾ˆä¸èˆ’æœçš„ã€‚æ¯•ç«Ÿå®¢æˆ·ç«¯çš„ Vueã€React ä¸€å¥—æ¨¡æ¿ï¼ŒæœåŠ¡ç«¯å¦ä¸€å¥—æ¨¡æ¿ï¼Œå†™åˆ°ç²¾ç¥åˆ†è£‚ã€‚é‚£èƒ½ä¸èƒ½åˆäºŒä¸ºä¸€å‘¢ã€‚å°±æœ‰äº†åŒæ„æ¸²æŸ“ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶çœ‹åˆ°çš„ååˆ†æœ‰æ­§ä¹‰çš„æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆssrï¼‰ã€‚çœ‹èµ·æ¥ä»¿ä½›ç»•äº†ä¸€ä¸ªå¤§åœˆï¼Œæ¨¡æ¿æ¸²æŸ“è¿˜æ˜¯å›åˆ°æœåŠ¡ç«¯è¿™è¾¹ï¼Œä½†åˆæœ‰å¾ˆå¤§çš„ä¸åŒå’Œæ”¹è¿›ã€‚</p>
<p>â€œå†å²æ€»æ˜¯èºæ—‹å¼å‰è¿›çš„ã€‚â€</p>
<p>éšå Reactã€Vueç­‰æ¡†æ¶ä¹Ÿè·Ÿè¿›äº†è‡ªå·±çš„ ssr æ–¹æ¡ˆï¼Œæœ¬æ–‡å°±æ¥è¯´ä¸€ä¸‹ vue ssr ç›¸å…³çš„å†…å®¹ä»¥åŠæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­çš„ä¸€äº›å®è·µã€‚</p>
<h2 id="ä½¿ç”¨-vue-ssr">ä½¿ç”¨ Vue SSR</h2>
<p>vue çš„ ssr æ“ä½œä¸Šè¿˜æ˜¯å¾ˆç®€å•çš„ï¼šæœåŠ¡ç«¯åˆ›å»ºä¸€ä¸ª vue å®ä¾‹ï¼Œäº¤ç»™ vue-server-renderï¼Œæ¸²æŸ“æˆä¸€æ®µ html è¾“å‡ºåˆ°æµè§ˆå™¨é‡Œã€‚</p>
<pre><code class="language-js">const Vue = require('vue')
const app = new Vue({
  template: `&lt;div&gt;Hello World&lt;/div&gt;`
})

const renderer = require('vue-server-renderer').createRenderer()

renderer.renderToString(app, (err, html) =&gt; {
  if (err) throw err
  console.log(html)
  // =&gt; &lt;div data-server-rendered=&quot;true&quot;&gt;Hello World&lt;/div&gt;
})
</code></pre>
<p>ä½†æ¶‰åŠåˆ°å…·ä½“åº”ç”¨ï¼Œä¸å¯èƒ½ç›´æ¥ç”¨ä¸Šè¿°ä»£ç ï¼ˆè™½ç„¶æˆ‘çœŸçš„åœ¨æŸäº›åœºæ™¯ä¸‹ç”¨è¿‡ğŸ˜‚ï¼‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¦ä½¿ç”¨ webpackï¼Œåˆ†åˆ«æ„å»ºæœåŠ¡å™¨æ‰€éœ€è¦çš„æœåŠ¡ç«¯ bundle å’Œæµè§ˆå™¨æ‰€ç”¨çš„å®¢æˆ·ç«¯ bundleï¼Œå°†ä¸¤è€…äº¤ç»™ vue-server-renderï¼ŒåŒæ ·è·å– vue å®ä¾‹æ¸²æŸ“æˆ html è¾“å‡ºæµè§ˆå™¨ï¼Œåœ¨æµè§ˆå™¨ç«¯åˆ™å¯ä»¥ç»§ç»­äº«å—æ•°æ®ç»‘å®šå¸¦æ¥çš„ä¾¿åˆ©ã€‚åŒæ—¶ï¼Œå› ä¸ºæœ‰äº† webpack ä»‹å…¥ï¼Œå¯ä»¥åœ¨å¼€å‘ç¯å¢ƒè·å¾—æ›´å¥½çš„ä½“éªŒã€‚</p>
<p><img src="https://cloud.githubusercontent.com/assets/499550/17607895/786a415a-5fee-11e6-9c11-45a2cfdf085c.png" alt=""></p>
<p>ä¸è¿‡æ¯•ç«Ÿï¼ŒSSR æ¨¡å¼çš„ vue æ˜¯åŒæ—¶å­˜åœ¨äºæœåŠ¡ç«¯å’Œæµè§ˆå™¨ç«¯çš„ï¼Œæ‰€ä»¥åœ¨ç¼–ç çš„æ—¶å€™è¿˜æ˜¯æœ‰å¾ˆå¤šæ³¨æ„çš„ç‚¹ï¼š</p>
<h4 id="åº”ç”¨ç¨‹åºå®ä¾‹ç‹¬ç«‹-é˜²æ­¢äº¤å‰æ±¡æŸ“ï¼š">åº”ç”¨ç¨‹åºå®ä¾‹ç‹¬ç«‹ï¼Œé˜²æ­¢äº¤å‰æ±¡æŸ“ï¼š</h4>
<p>æµè§ˆå™¨ç¯å¢ƒï¼Œæ¯ä¸ªç”¨æˆ·ä¼šæŠŠä»£ç ä¸‹è½½åˆ°è‡ªå·±æœ¬åœ°ï¼Œè‡ªç„¶æ¯ä¸ªç”¨æˆ·äº«å—ç‹¬ç«‹çš„ vue å®ä¾‹ã€‚è€ŒæœåŠ¡å™¨ä¸åŒï¼Œæ¯ä¸ªç”¨æˆ·çš„è¯·æ±‚éƒ½ä¼šåˆ°æœåŠ¡å™¨ï¼Œæ‰€ä»¥ä¸ºäº†é˜²æ­¢äº¤å‰æ±¡æŸ“ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½åº”è¯¥æ˜¯ç‹¬ç«‹çš„å®ä¾‹ã€‚ä»£ç ä¸€èˆ¬çœ‹èµ·æ¥æ˜¯è¿™æ ·ï¼š</p>
<pre><code class="language-js">server.get('*', (req, res) =&gt; {
  const app = new Vue({
    data: {
      url: req.url
    },
    template: `&lt;div&gt;è®¿é—®çš„ URL æ˜¯ï¼š {{ url }}&lt;/div&gt;`
  })

  renderer.renderToString(app, (err, html) =&gt; {
    if (err) {
      res.status(500).end('Internal Server Error')
      return
    }
    res.end(`
      &lt;!DOCTYPE html&gt;
      &lt;html lang=&quot;en&quot;&gt;
        &lt;head&gt;&lt;title&gt;Hello&lt;/title&gt;&lt;/head&gt;
        &lt;body&gt;${html}&lt;/body&gt;
      &lt;/html&gt;
    `)
  })
})
</code></pre>
<h4 id="é¿å…æœåŠ¡ç«¯æ‰§è¡Œçš„é€»è¾‘å¼•å…¥æµè§ˆå™¨å˜é‡å’Œå‰¯ä½œç”¨ä»£ç ">é¿å…æœåŠ¡ç«¯æ‰§è¡Œçš„é€»è¾‘å¼•å…¥æµè§ˆå™¨å˜é‡å’Œå‰¯ä½œç”¨ä»£ç </h4>
<p>æœåŠ¡ç«¯åªæœ‰ beforeCreated/created ä¸¤ä¸ªé’©å­ä¼šæ‰§è¡Œï¼Œå¦‚æœæ­¤æ—¶æ‰§è¡Œ windowã€documentç­‰å˜é‡ï¼Œå¿…ç„¶æŠ¥é”™ã€‚</p>
<p>åŒæ—¶ä¹Ÿé˜²æ­¢åœ¨è¿™ä¸¤ä¸ªé’©å­å¼•å…¥ setIntervalã€setTimeout ç­‰ä»£ç ã€‚ä¸åŒäºæµè§ˆå™¨ï¼Œåœ¨ created åˆ›å»ºå®šæ—¶å™¨å¯ä»¥åœ¨ destroy æ—¶é”€æ¯æ‰ï¼ŒæœåŠ¡ç«¯ä¸­åªä¼šæ‰§è¡Œ beforeCreated/created ä¸¤ä¸ªé’©å­ï¼Œæ— å¤„é”€æ¯ï¼Œå¸¸é©»å†…å­˜ï¼Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚</p>
<p>æ‰€ä»¥å¯ä»¥æŠŠæµè§ˆå™¨å’Œå®šæ—¶å™¨ç­‰ç›¸å…³é€»è¾‘ç§»åŠ¨è‡³ mounted é’©å­ä¸­ã€‚</p>
<h4 id="å°½é‡ç¼–å†™å¹³å°é€šç”¨çš„ä»£ç ">å°½é‡ç¼–å†™å¹³å°é€šç”¨çš„ä»£ç </h4>
<p>æœ€å¸¸ç”¨çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨ axios ä½œä¸ºå‘é€è¯·æ±‚çš„å·¥å…·ï¼Œå› ä¸ºå®ƒé€‚é…äº† node å’Œæµè§ˆå™¨ã€‚å¦‚æœä½¿ç”¨å…¶ä»–åº“ï¼Œä¸€å®šè¦æ³¨æ„æ˜¯å¦å¹³å°é€šç”¨ï¼Œå¦åˆ™éœ€è¦ç»™ä¸¤ç«¯é€‚é…ã€‚</p>
<h4 id="ç¼–å†™æ ‡å‡†çš„-html-æ¨¡æ¿">ç¼–å†™æ ‡å‡†çš„ HTML æ¨¡æ¿</h4>
<p>æµè§ˆå™¨æ¯”è¾ƒæ™ºèƒ½ï¼Œä¼šè‡ªåŠ¨ä¿®å¤ä¸æ ‡å‡†çš„HTMLç»“æ„ï¼Œä½† vue ç”Ÿæˆçš„è™šæ‹Ÿ DOM ä¸ä¼šï¼Œæ‰€ä»¥å½“åœ¨ vue æ¨¡æ¿å†™å¦‚ä¸‹ä»£ç æ—¶ï¼š</p>
<pre><code class="language-html">&lt;table&gt;
  &lt;tr&gt;&lt;td&gt;hi&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
</code></pre>
<p>æµè§ˆå™¨ä¼šè‡ªåŠ¨ä¿®å¤è¿™æ®µ html, å’Œ vue ç”Ÿæˆçš„è™šæ‹Ÿ DOM ä¸åŒ¹é…ï¼Œé¡µé¢å°±ä¼šæŠ¥ä¸€ä¸ªæœåŠ¡ç«¯æ¨¡æ¿å’Œå®¢æˆ·ç«¯æ¨¡æ¿ä¸åŒ¹é…çš„é”™è¯¯ã€‚</p>
<h4 id="è‡ªå®šä¹‰æŒ‡ä»¤">è‡ªå®šä¹‰æŒ‡ä»¤</h4>
<p>æŒ‡ä»¤ä¸€èˆ¬æ„å‘³ç€æ“ä½œ DOMï¼Œå°±å¾ˆæœ‰å¯èƒ½åœ¨æœåŠ¡ç«¯æ¸²æŸ“ä¸­æŠ¥é”™ã€‚æ‰€ä»¥éœ€è¦æä¾›ä¸¤ä¸ªç‰ˆæœ¬ä½œä¸ºé€‚é…ï¼Œæˆ–è€…æŠ½è±¡ä¸ºç»„ä»¶ã€‚</p>
<h4 id="æœåŠ¡å™¨å‹åŠ›">æœåŠ¡å™¨å‹åŠ›</h4>
<p>vue è™šæ‹Ÿ DOM æ“ä½œæ˜¯ä¸€ä¸ªå¾ˆè€— CPU çš„æ“ä½œï¼Œå’Œæ™®é€šçš„æ¨¡æ¿å­—ç¬¦ä¸²æ‹¼æ¥æ€§èƒ½å·®è·å¾ˆå¤§ã€‚æ‰€ä»¥éœ€è¦åšå¥½å‹æµ‹å’Œç¼“å­˜æ–¹æ¡ˆã€‚</p>
<p>å¦‚æœç”¨æˆ·è®¿é—®çš„å†…å®¹ä¸æ˜¯ä¸ªæ€§åŒ–çš„ï¼ˆè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ¨èåš ssr çš„åœºæ™¯ï¼‰ï¼Œé‚£ä¹ˆé¡µé¢çº§åˆ«çš„ç¼“å­˜æ”¶ç›Šå°±ç›¸å½“çš„å¤§ã€‚</p>
<pre><code class="language-js">const microCache = LRU({
  max: 100,
  maxAge: 1000 // é‡è¦æç¤ºï¼šæ¡ç›®åœ¨ 1 ç§’åè¿‡æœŸã€‚
})

const isCacheable = req =&gt; {
  // å®ç°é€»è¾‘ä¸ºï¼Œæ£€æŸ¥è¯·æ±‚æ˜¯å¦æ˜¯ç”¨æˆ·ç‰¹å®š(user-specific)ã€‚
  // åªæœ‰éç”¨æˆ·ç‰¹å®š (non-user-specific) é¡µé¢æ‰ä¼šç¼“å­˜
}

server.get('*', (req, res) =&gt; {
  const cacheable = isCacheable(req)
  if (cacheable) {
    const hit = microCache.get(req.url)
    if (hit) {
      return res.end(hit)
    }
  }

  renderer.renderToString((err, html) =&gt; {
    res.end(html)
    if (cacheable) {
      microCache.set(req.url, html)
    }
  })
})
</code></pre>
<p>åœ¨åšäº†é¡µé¢çº§åˆ«çš„ç¼“å­˜ä¹‹åï¼Œç»è¿‡å‹æµ‹ï¼Œæ€§èƒ½æé«˜äº†5å€ã€‚ï¼ˆä¸åŒä¸šåŠ¡åœºæ™¯æœ‰æ‰€ä¸åŒï¼‰ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œè™½ç„¶ ssr å¸¦æ¥äº† seo å’Œé¦–å±é€Ÿåº¦çš„ä¼˜åŠ¿ï¼ˆåœ¨å½“å‰ç½‘é€Ÿç¯å¢ƒä¸‹ï¼Œè¿™ä¸ªä¼˜åŠ¿è¿˜æ˜¯ä¸æ˜¯ä¼˜åŠ¿ï¼Ÿï¼‰ï¼Œä½†å¼€å‘æˆæœ¬ä¹Ÿæ˜¯æ°´æ¶¨èˆ¹é«˜ï¼Œå¼€å‘æ¡ä»¶å—é™åˆ¶ã€ä¸åŒçš„æ„å»ºè„šæœ¬ã€æ›´å¤šçš„æœåŠ¡å™¨å‹åŠ›ã€æ›´å¤§çš„è¿ç»´æˆæœ¬ã€‚</p>
<p>å¯¹äº†ä¸€çº¿ä¸šåŠ¡å¼€å‘äººå‘˜ï¼Œå…¶å®æ›´å¤šå…³æ³¨çš„å¼€å‘å’Œæ„å»ºçš„ä¾¿åˆ©æ€§ï¼Œåæ¥æˆ‘ä»¬çœ‹åˆ°äº† nuxtã€‚</p>
<h2 id="nuxt">NUXT</h2>
<p>nuxt è§£å†³äº†æ„å»ºé…ç½®å’Œæµè§ˆå™¨ç‰¹å®šä»£ç çš„å¤„ç†ï¼Œå¹¶æ‰©å±•äº†ä¸€äº›æ¦‚å¿µï¼Œç»™äº†å¼€å‘è€…æ›´å¤§çš„è‡ªç”±ã€‚</p>
<h4 id="çº¦å®šå¤§äºé…ç½®">çº¦å®šå¤§äºé…ç½®</h4>
<p>nuxt å¯¹äºåŸç”Ÿ ssræœ‰ç‚¹åƒ eggjs å¯¹äº koaï¼ŒæŠŠå¾ˆå¤šé€šç”¨çš„éƒ¨åˆ†å›ºåŒ–ä¸‹æ¥ï¼špages å°±ä»£è¡¨è·¯ç”±ï¼Œstore ç›®å½•ä»£è¡¨çŠ¶æ€ç®¡ç†ï¼Œstaticä»£è¡¨é™æ€èµ„æºã€‚</p>
<p><img src="https://haitao.nos.netease.com/89cade21-40e0-4f4f-8b83-f4947bc61bb2_772_1158.jpg" alt=""></p>
<h4 id="å¼•å…¥æ¦‚å¿µ-middleware">å¼•å…¥æ¦‚å¿µ - middleware</h4>
<p>ç±»ä¼¼äºæœåŠ¡ç«¯ä¸­é—´ä»¶ï¼Œnuxt çš„ä¸­é—´ä»¶ä½œç”¨ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæ¯æ¬¡è®¿é—®è·¯ç”±éƒ½ä¼šæ‰§è¡Œã€‚æ¯”å¦‚é€ä¼  cookie è¿™ç§æ¯”è¾ƒç¹ççš„æ“ä½œï¼Œnuxt é‡Œå°±å˜å¾—å¾ˆç®€å•ï¼š</p>
<pre><code class="language-js">export default function(ctx) {
    if (process.server) {
        ctx.$axios.defaults.headers.common.cookie = ctx.req.headers.cookie;
    }
}
</code></pre>
<h4 id="å¼•å…¥æ¦‚å¿µ-plugin">å¼•å…¥æ¦‚å¿µ - plugin</h4>
<p>é€šå¸¸åº”ç”¨å¯åŠ¨å‰æˆ‘ä»¬ä¼šæŠŠä¸€äº›åº“æŒ‚è½½åˆ° Vue å®ä¾‹ä¸Šï¼Œä½†ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œssr è¦æ³¨æ„æµè§ˆå™¨å˜é‡çš„æ··å…¥ï¼Œæ‰€ä»¥ä¹‹å‰çš„æˆ‘ä»¬çš„ä»£ç æ˜¯è¿™æ ·å­ï¼š</p>
<pre><code class="language-js">if(process.env.VUE_ENV !== 'server') {
    const Sentry = require('@sentry/browser');
    Vue.prototype.Sentry = Sentry;
}
</code></pre>
<p>ä¼šçœ‹åˆ°éœ€è¦è‡ªå·±åšç¯å¢ƒåˆ¤æ–­ï¼Œé€šè¿‡ if å¼•å…¥nuxt å¼•å…¥äº† plugin æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œnuxt è´´å¿ƒçš„ä½¿ç”¨äº† ssr false è¿™ä¸ªé€‰é¡¹å»æ‰äº†ç¹ççš„åˆ¤æ–­ã€‚</p>
<pre><code class="language-js">// plugins/sentry.js
import SentryVuePlugin from '@sentry/browser';
Vue.prototype.Sentry = Sentry;

// nuxt.config.js
plugins: [
    {
        src: '~/plugins/sentry',
        ssr: false
    }
]
</code></pre>
<h4 id="å¼•å…¥æ¦‚å¿µ-module">å¼•å…¥æ¦‚å¿µ - module</h4>
<p>è¿™ä¸ªæ‰©å±•ç»™å¼€å‘è€…æ›´å¤§è‡ªç”±å»æ“ä½œ nuxtï¼Œæ¯”å¦‚æˆ‘ä»¬é€šè¿‡å®šåˆ¶ renderer.renderRoute å®ç°é¡µé¢çº§ç¼“å­˜ï¼š</p>
<pre><code class="language-js">export default function cachePage(moduleOptions) {
    const renderer = this.nuxt.renderer;
    const renderRoute = renderer.renderRoute.bind(renderer);

    renderer.renderRoute = (route, context) =&gt; {
        let cacheRoute = '/cacheRoute';
        if(cacheRoute) {
            const cache = cacheStore.get(cacheRoute);
            if(cache) {
                console.log('hit cache');
                return cache;
            }
        }

        return renderRoute(route, context).then((result) =&gt; {
            if(!result.error) {
                cacheStore.set(route, result);
            }
            return result;
        });
    };
}
</code></pre>
<p>æœ€åï¼Œnuxt å¤©ç„¶å¯ä»¥ä½œä¸º expressã€koa çš„ä¸­é—´ä»¶å­˜åœ¨ï¼Œæ‰€ä»¥nuxtå¾ˆå®¹æ˜“èå…¥ç°æœ‰çš„æ¡†æ¶ä¸­ã€‚</p>
<p>æ‰€ä»¥è€ƒè™‘åˆ°å¼€å‘è€…ä¾¿åˆ©å’Œæ¡†æ¶æˆç†Ÿåº¦ï¼Œè¿˜æ˜¯æ¯”è¾ƒå»ºè®®ä½¿ç”¨ nuxt çš„ï¼Œå½“ç„¶ï¼Œå¦‚æœä¸ºäº†ç†Ÿæ‚‰ vue ssrï¼Œä¹Ÿå»ºè®®å°è¯•ä¸‹<a href="https://github.com/vuejs/vue-hackernews-2.0" target="_blank" rel="noopener">å®˜æ–¹çš„ demo</a>ã€‚</p>

    </div>

    
    <div class="update-tip">**æœ¬æ–‡äº 2020/2/4, 4:57:33 ä¸‹åˆ é‡æ–°ç¼–è¾‘**</div>
    

    <div class="comment">
        <!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  -->
        <div id="lv-container" data-id="city" data-uid="MTAyMC8zMDYwNS83MTYw">
            <script type="text/javascript">
           (function(d, s) {
               var j, e = d.getElementsByTagName(s)[0];

               if (typeof LivereTower === 'function') { return; }

               j = d.createElement(s);
               j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
               j.async = true;

               e.parentNode.insertBefore(j, e);
           })(document, 'script');
            </script>
        <noscript> ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>
        </div>
        <!-- Cityç‰ˆå®‰è£…ä»£ç å·²å®Œæˆ -->        
    </div>

</div>
<script src="/posts/js/post.js"></script>
    </div>

    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script type="text/javascript">
        hljs.initHighlightingOnLoad();
    </script>
</body>
</html>